<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>rphys wasm demo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-0: #0b0f14;
        --bg-1: #0e141d;
        --panel: #101924;
        --panel-2: #141f2c;
        --border: rgba(255, 255, 255, 0.08);
        --text: #e7edf4;
        --muted: #9aa7b4;
        --accent: #6ad1ff;
        --accent-2: #58d07a;
        --toolbar-height: 56px;
      }
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        overflow: hidden;
        background: radial-gradient(1200px 600px at 15% 0%, #121a24 0%, var(--bg-0) 55%) fixed;
        color: var(--text);
        font-family: "Space Grotesk", "Segoe UI", sans-serif;
      }
      canvas {
        display: block;
        width: 100%;
        height: 100%;
      }
      #app {
        position: fixed;
        inset: 0;
        display: grid;
        grid-template-rows: var(--toolbar-height) 1fr;
      }
      .topbar {
        display: flex;
        align-items: center;
        gap: 18px;
        padding: 0 16px;
        background: linear-gradient(90deg, rgba(16, 25, 36, 0.95), rgba(16, 25, 36, 0.75));
        border-bottom: 1px solid var(--border);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        font-size: 13px;
      }
      .brand .logo {
        width: 14px;
        height: 14px;
        border-radius: 4px;
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        box-shadow: 0 0 12px rgba(106, 209, 255, 0.45);
      }
      .menu {
        display: flex;
        gap: 6px;
      }
      .menu button {
        font: inherit;
        background: transparent;
        border: 1px solid transparent;
        color: var(--muted);
        padding: 6px 10px;
        border-radius: 8px;
        letter-spacing: 0.02em;
      }
      .menu button:hover {
        color: var(--text);
        border-color: var(--border);
      }
      .toolgroup {
        display: flex;
        gap: 6px;
        padding: 4px;
        border-radius: 10px;
        background: rgba(20, 31, 44, 0.7);
        border: 1px solid var(--border);
      }
      .tool {
        font: inherit;
        background: transparent;
        border: 1px solid transparent;
        color: var(--text);
        padding: 6px 10px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
      }
      .tool:hover {
        border-color: rgba(106, 209, 255, 0.4);
        box-shadow: inset 0 0 0 1px rgba(106, 209, 255, 0.2);
      }
      .tool .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--accent);
      }
      .spacer {
        flex: 1;
      }
      .actions {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .action-btn {
        font: inherit;
        background: rgba(16, 25, 36, 0.7);
        border: 1px solid var(--border);
        color: var(--text);
        font-weight: 500;
        letter-spacing: 0.02em;
        padding: 6px 14px;
        border-radius: 10px;
        transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
      }
      .action-btn:hover {
        border-color: rgba(106, 209, 255, 0.5);
        box-shadow: inset 0 0 0 1px rgba(106, 209, 255, 0.2);
      }
      .action-btn--primary {
        background: linear-gradient(135deg, rgba(106, 209, 255, 0.18), rgba(88, 208, 122, 0.2));
        border: 1px solid rgba(106, 209, 255, 0.4);
      }
      .action-btn--primary:hover {
        border-color: rgba(106, 209, 255, 0.75);
      }
      #sim-toggle-btn[data-state="paused"] {
        background: linear-gradient(135deg, rgba(88, 208, 122, 0.22), rgba(106, 209, 255, 0.15));
        border-color: rgba(88, 208, 122, 0.55);
        box-shadow: inset 0 0 0 1px rgba(88, 208, 122, 0.2);
      }
      .toggle-group {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 6px 10px;
        border-radius: 10px;
        background: rgba(12, 18, 26, 0.7);
        border: 1px solid var(--border);
      }
      .toggle-title {
        font-size: 10px;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: var(--muted);
      }
      .toggle {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        color: var(--text);
        letter-spacing: 0.06em;
        text-transform: uppercase;
        position: relative;
        cursor: pointer;
      }
      .toggle input {
        position: absolute;
        opacity: 0;
        pointer-events: none;
      }
      .track {
        width: 28px;
        height: 14px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.12);
        display: inline-flex;
        align-items: center;
        padding: 1px;
        transition: background 0.2s ease, border 0.2s ease;
      }
      .thumb {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(231, 237, 244, 0.85);
        transform: translateX(0);
        transition: transform 0.2s ease, background 0.2s ease;
      }
      .toggle input:checked + .track {
        background: rgba(106, 209, 255, 0.3);
        border-color: rgba(106, 209, 255, 0.6);
      }
      .toggle input:checked + .track .thumb {
        transform: translateX(12px);
        background: rgba(106, 209, 255, 0.95);
      }
      .toggle-label {
        font-family: "JetBrains Mono", monospace;
      }
      .select-group {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 8px 12px;
        border-radius: 12px;
        background: rgba(16, 25, 36, 0.65);
        border: 1px solid var(--border);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02);
      }
      .select-block {
        display: flex;
        flex-direction: column;
        gap: 4px;
        min-width: 160px;
      }
      .select-label {
        font-size: 10px;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        color: var(--muted);
      }
      .select {
        appearance: none;
        font: inherit;
        background: linear-gradient(135deg, rgba(20, 31, 44, 0.8), rgba(14, 20, 29, 0.9));
        border: 1px solid rgba(255, 255, 255, 0.08);
        color: var(--text);
        padding: 8px 12px;
        border-radius: 10px;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }
      .select:focus {
        outline: none;
        border-color: rgba(106, 209, 255, 0.6);
        box-shadow: 0 0 0 1px rgba(106, 209, 255, 0.25);
      }
      #viewport {
        position: relative;
        width: 100%;
        height: 100%;
        background: radial-gradient(600px 400px at 70% 10%, #111a24 0%, #0b0f14 60%);
      }
      .setup-panel {
        position: fixed;
        top: calc(var(--toolbar-height) + 10px);
        right: 80px;
        width: 1040px;
        max-width: min(1180px, 98vw);
        max-height: calc(100% - var(--toolbar-height) - 20px);
        overflow: hidden;
        border-radius: 14px;
        background: linear-gradient(160deg, rgba(16, 25, 36, 0.92), rgba(12, 18, 26, 0.9));
        border: 1px solid var(--border);
        box-shadow: 0 24px 48px rgba(0, 0, 0, 0.45);
        display: grid;
        grid-template-rows: auto 1fr auto;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease, transform 0.2s ease;
        transform: translateY(6px);
      }
      .setup-panel.is-open {
        opacity: 1;
        pointer-events: auto;
        transform: translateY(0);
      }
      .setup-header {
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 8px;
        border-bottom: 1px solid var(--border);
      }
      .setup-title {
        font-size: 13px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }
      .setup-body {
        padding: 14px 18px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .setup-footer {
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 8px;
        border-top: 1px solid var(--border);
        background: rgba(12, 18, 26, 0.9);
      }
      .setup-footer button {
        flex: 1;
      }
      .setup-section {
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 10px 10px;
        background: rgba(12, 18, 26, 0.55);
      }
      .setup-section h3 {
        margin: 0 0 8px 0;
        font-size: 12px;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: var(--muted);
      }
      .field-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 16px;
      }
      .field-row.stack {
        grid-template-columns: 1fr;
      }
      .field {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .field label {
        font-size: 11px;
        color: var(--muted);
        letter-spacing: 0.04em;
      }
      .field input {
        background: rgba(10, 14, 20, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.08);
        color: var(--text);
        border-radius: 8px;
        padding: 7px 9px;
        font: inherit;
      }
      .field input:focus {
        outline: none;
        border-color: rgba(106, 209, 255, 0.7);
        box-shadow: 0 0 0 1px rgba(106, 209, 255, 0.15);
      }
      .cluster-card {
        border: 1px dashed rgba(106, 209, 255, 0.45);
        border-radius: 12px;
        padding: 10px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        background: rgba(10, 14, 20, 0.45);
      }
      .cluster-header {
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: space-between;
      }
      .cluster-title {
        font-size: 12px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--text);
      }
      .chip {
        padding: 4px 8px;
        border-radius: 999px;
        background: rgba(106, 209, 255, 0.14);
        border: 1px solid rgba(106, 209, 255, 0.35);
        font-size: 11px;
        color: var(--text);
      }
      .icon-btn {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.08);
        color: var(--text);
        border-radius: 8px;
        padding: 6px 8px;
        cursor: pointer;
      }
      .icon-btn:hover {
        border-color: rgba(255, 255, 255, 0.2);
      }
      .pill {
        font-family: "JetBrains Mono", monospace;
        font-size: 11px;
        padding: 3px 8px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .group-color-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .group-color-row {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .group-color-row label {
        font-size: 12px;
        color: var(--text);
        min-width: 84px;
      }
      .group-color-row input[type="color"] {
        width: 44px;
        height: 28px;
        border: none;
        background: transparent;
        padding: 0;
        cursor: pointer;
      }
      .config-actions {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      .record-actions {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 10px;
      }
      .record-actions .pill {
        margin-left: auto;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <header class="topbar">
        <div class="brand">
          <span class="logo"></span>
          rphys
        </div>
        <nav class="menu">
          <button type="button">File</button>
          <button type="button">View</button>
          <button type="button">Sim</button>
        </nav>
        <div class="toolgroup">
          <button class="tool" type="button">
            <span class="dot"></span>
            Select
          </button>
          <button class="tool" type="button">Orbit</button>
          <button class="tool" type="button">Pan</button>
        </div>
        <div class="toggle-group">
          <div class="toggle-title">Planes</div>
          <label class="toggle">
            <input id="toggle-plane-xy" type="checkbox" />
            <span class="track"><span class="thumb"></span></span>
            <span class="toggle-label">XY</span>
          </label>
          <label class="toggle">
            <input id="toggle-plane-xz" type="checkbox" checked />
            <span class="track"><span class="thumb"></span></span>
            <span class="toggle-label">XZ</span>
          </label>
          <label class="toggle">
            <input id="toggle-plane-yz" type="checkbox" />
            <span class="track"><span class="thumb"></span></span>
            <span class="toggle-label">YZ</span>
          </label>
        </div>
        <div class="toggle-group">
          <div class="toggle-title">Mode</div>
          <label class="toggle">
            <input id="toggle-plane-2d" type="checkbox" />
            <span class="track"><span class="thumb"></span></span>
            <span class="toggle-label">2D</span>
          </label>
        </div>
        <div class="toggle-group">
          <div class="toggle-title">Axes</div>
          <label class="toggle">
            <input id="toggle-axis-x" type="checkbox" checked />
            <span class="track"><span class="thumb"></span></span>
            <span class="toggle-label">X</span>
          </label>
          <label class="toggle">
            <input id="toggle-axis-y" type="checkbox" checked />
            <span class="track"><span class="thumb"></span></span>
            <span class="toggle-label">Y</span>
          </label>
          <label class="toggle">
            <input id="toggle-axis-z" type="checkbox" checked />
            <span class="track"><span class="thumb"></span></span>
            <span class="toggle-label">Z</span>
          </label>
        </div>
        <div class="select-group">
          <div class="select-block">
            <div class="select-label">Model</div>
            <select id="model-select" class="select"></select>
          </div>
          <div class="select-block">
            <div class="select-label">Algorithm</div>
            <select id="algorithm-select" class="select"></select>
          </div>
        </div>
        <div class="spacer"></div>
        <div class="actions">
          <button id="setup-toggle-btn" class="action-btn" type="button">Setup</button>
          <button id="sim-toggle-btn" class="action-btn" type="button">Pause</button>
          <button id="sim-restart-btn" class="action-btn" type="button">Restart</button>
          <button id="home-btn" class="action-btn action-btn--primary" type="button">Home</button>
        </div>
      </header>
      <div id="viewport"></div>
      <aside id="setup-panel" class="setup-panel">
        <div class="setup-header">
          <div class="setup-title">Initial Conditions</div>
          <span id="agent-total" class="pill">0 agents</span>
        </div>
        <div class="setup-body">
          <div class="setup-section">
            <h3>Time step</h3>
            <div class="field-row">
              <div class="field">
                <label for="dt-input">dt (s)</label>
                <input id="dt-input" type="number" step="0.001" min="0.0001" value="0.016" />
              </div>
              <div class="field">
                <label>Algorithm</label>
                <select id="algorithm-select-panel" class="select"></select>
              </div>
            </div>
            <div class="field">
              <label class="toggle" style="gap: 10px; align-items: center; width: fit-content;">
                <input id="panel-plane2d-toggle" type="checkbox" />
                <span class="track"><span class="thumb"></span></span>
                <span class="toggle-label">2D mode</span>
              </label>
            </div>
          </div>
          <div class="setup-section">
            <h3>Clusters</h3>
            <div id="cluster-list" class="cluster-list" style="display: flex; flex-direction: column; gap: 10px;"></div>
            <button id="add-cluster-btn" class="action-btn" type="button" style="margin-top: 6px;">Add Cluster</button>
          </div>
          <div class="setup-section">
            <h3>Groups</h3>
            <div id="group-color-list" class="group-color-list"></div>
          </div>
          <div class="setup-section">
            <h3>Recording</h3>
            <div class="field-row">
              <div class="field">
                <label>Capture</label>
                <label class="toggle" style="gap: 10px; align-items: center; width: fit-content;">
                  <input id="record-toggle" type="checkbox" />
                  <span class="track"><span class="thumb"></span></span>
                  <span class="toggle-label">Record</span>
                </label>
              </div>
              <div class="field">
                <label for="record-stride-input">Sample every (steps)</label>
                <input id="record-stride-input" type="number" min="1" step="1" value="1" />
              </div>
              <div class="field">
                <label for="record-max-frames-input">Max frames (0 = no limit)</label>
                <input id="record-max-frames-input" type="number" min="0" step="1" value="0" />
              </div>
            </div>
            <div class="record-actions" style="margin-top: 8px;">
              <button id="record-download-btn" class="action-btn" type="button">Download History</button>
              <button id="record-clear-btn" class="action-btn" type="button">Clear</button>
              <span id="record-status" class="pill">0 frames</span>
            </div>
          </div>
          <div class="setup-section">
            <h3>Config</h3>
            <div class="config-actions">
              <button id="save-config-btn" class="action-btn" type="button">Save Config</button>
              <button id="load-config-btn" class="action-btn" type="button">Load Config</button>
            </div>
            <input id="config-file-input" type="file" accept="application/json" style="display:none" />
          </div>
        </div>
        <div class="setup-footer">
          <button id="apply-setup-btn" class="action-btn action-btn--primary" type="button">Apply Setup</button>
          <button id="close-setup-btn" class="action-btn" type="button">Close</button>
        </div>
      </aside>
    </div>
    <script type="module" src="./main.js"></script>
  </body>
</html>
